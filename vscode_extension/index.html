<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="x5-fullscreen" content="true"><meta name="full-screen" content="yes"><meta name="theme-color" content="#317EFB"><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=0" name="viewport"><meta name="keywords" content="vscode,C#,.Net,JavaScript,HTML,CSS"><meta name="description" content="最近闲来无事，给公司框架做了开发代码片段提示和一些常用工具整合的插，在这里记录一下踩过的坑和一些常用的基本功能示例。"><meta property="og:type" content="article"><meta property="og:title" content="vscode 插件开发指北 (一)"><meta property="og:url" content="https://www.imalun.com/vscode_extension/index.html"><meta property="og:site_name" content="白云苍狗"><meta property="og:description" content="最近闲来无事，给公司框架做了开发代码片段提示和一些常用工具整合的插，在这里记录一下踩过的坑和一些常用的基本功能示例。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.imalun.com/images/posts/vscode_extension/20210615205632.png"><meta property="og:image" content="https://www.imalun.com/images/posts/vscode_extension/20210615205655.png"><meta property="og:image" content="https://www.imalun.com/images/posts/vscode_extension/20210616211914.png"><meta property="og:image" content="https://www.imalun.com/images/posts/vscode_extension/20210616230737.png"><meta property="article:published_time" content="2021-06-12T23:20:59.000Z"><meta property="article:modified_time" content="2021-07-16T05:23:20.737Z"><meta property="article:author" content="白云苍狗"><meta property="article:tag" content="vscode"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.imalun.com/images/posts/vscode_extension/20210615205632.png"><meta name="description" content="学习.Net,前端时长三年的,程序猿"><title>白云苍狗 - vscode 插件开发指北 (一)</title><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=0.2.10"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="canonical" href="https://www.imalun.com/vscode_extension/"><link rel="stylesheet" href="//at.alicdn.com/t/font_1518765_5jbj7btfht2.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/MoePlayer/APlayer@1.10.1/dist/APlayer.min.css"><link rel="stylesheet" href="/css/index.css?v=0.2.10.css"><script type="text/javascript">~function () {
            let setting = localStorage.getItem('setting') ? JSON.parse(localStorage.getItem('setting')) : {};
            let root = document.documentElement;
            for (let key in setting) {
                if (key === 'lightSwitch') {
                    root.classList[setting[key] ? 'add' : 'remove']('dark')
                } else if(key === 'themeColorPicker'){

                } else {
                    setting[key].css.forEach(item => { root.style.setProperty(item.key, item.val); })
                }
            }
        }();</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="白云苍狗" type="application/atom+xml"></head><body><div class="page-img-bg"></div><header class="layout-header"><button type="button" class="header-menu-btn"><i class="iconfont cg-toggle"></i></button><nav class="nav"><li><a data-pjax class="_pjax" href="/">白云苍狗</a></li><li><a data-pjax class="_pjax" href="/archives"><i class="iconfont cg-shijian"></i> 归档</a></li><li><a data-pjax class="_pjax" href="/links"><i class="iconfont cg-links"></i> 友情链接</a></li></nav></header><div class="layout-content"><header class="layout-content-header"><div class="shape"><span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></div><div class="banner" data-text="白云苍狗" data-interval="100"><div class="title-inner">白云苍狗</div><div class="user-des"><span style="width:55em;animation:typing 10s steps(55),caret .5s steps(1) infinite">「一觉游仙好梦，任它竹冷松寒。轩辕事，古今谈，风流河山。沉醉负白首，舒怀成大观。醒，亦在人间；梦，亦在人间」</span></div></div></header><div class="layout-content-content"><aside id="layout-content-aside" class="layout-content-aside"><div class="aside-nav-card shadow"><header><h2>白云苍狗</h2><p>亦在人间</p></header><ul><a href="/" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-home"></use></svg> 首页</li></a><a href="/links" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-links"></use></svg> 友情链接</li></a><a href="/comment" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-comment"></use></svg> 留言</li></a><a href="/atom.xml" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-rss"></use></svg> RSS</li></a><a href="//github.com/MaLuns" target="_blank" rel="noopener" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-github"></use></svg> Github</li></a><a href="//gitee.com/ml13" target="_blank" rel="noopener" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-gitee"></use></svg> Gitee</li></a><a href="tencent://message/?uin=384399021&amp;Site=有事Q我&amp;Menu=yes"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-qq"></use></svg> 联系我</li></a></ul></div><div class="user-card shadow"><img src="/images/avatar.jpg" alt="" class="avatar"><div><p style="margin:20px">醒，亦在人间；梦，亦在人间</p><div class="post-state"><div><span class="item-count">24 </span><span>文章</span></div><div><span class="item-count">3 </span><span>分类</span></div><div><span class="item-count">21 </span><span>标签</span></div></div></div><div id="post-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#插件能做什么"><span class="toc-number">1.</span> <span class="toc-text">插件能做什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建插件项目"><span class="toc-number">2.</span> <span class="toc-text">创建插件项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置说明"><span class="toc-number">3.</span> <span class="toc-text">配置说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令示例"><span class="toc-number">4.</span> <span class="toc-text">命令示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注册命令"><span class="toc-number">4.1.</span> <span class="toc-text">注册命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行命令"><span class="toc-number">4.2.</span> <span class="toc-text">执行命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#菜单示例"><span class="toc-number">5.</span> <span class="toc-text">菜单示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#控制命令面板的命令"><span class="toc-number">5.1.</span> <span class="toc-text">控制命令面板的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#when-条件"><span class="toc-number">5.2.</span> <span class="toc-text">when 条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置多级菜单"><span class="toc-number">5.3.</span> <span class="toc-text">配置多级菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分组排序"><span class="toc-number">5.4.</span> <span class="toc-text">分组排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册快捷键"><span class="toc-number">6.</span> <span class="toc-text">注册快捷键</span></a></li></ol></div></div></aside><div id="sidebar-mask"></div><main id="main" class="layout-content-main"><article class="shadow animated fadeInUp"><header class="post-header"><div class="post-container"><h2 class="post-title">「vscode 插件开发指北 (一)」</h2><div class="post-meta"><div><span class="post-push-time"><time datetime="2021-06-12T23:20:59.000Z" title="2021-06-12T23:20:59.000Z" itemprop="datePublished"><i class="iconfont cg-shijian"></i> 2021-06-12 </time><span class="post-meta-divider">•</span> </span><span><i class="iconfont cg-tag1"></i> 记录类 <span class="post-meta-divider">•</span> </span><span><i class="iconfont cg-tag1"></i> <a class="_pjax" href="/categories/记录类">记录类</a></span></div><span class="post-wordcount"><span class="post-meta-item-text"><i class="iconfont cg-wendang"></i> 共2.2k字 </span><span class="post-meta-divider">•</span> </span><span class="post-consuming-time"><span class="post-meta-item-text"><i class="iconfont cg-shalou"></i> 约8分钟</span></span></div></div></header><div id="nice" class="post-content post-content-detail"><p>最近闲来无事，给公司框架做了开发代码片段提示和一些常用工具整合的插，在这里记录一下踩过的坑和一些常用的基本功能示例。</p><a id="more"></a><h2 id="插件能做什么"><a href="#插件能做什么" class="headerlink" title="插件能做什么"></a>插件能做什么</h2><p>因为vscode是 Electron 的，所以一般node能做的一般基本上都是可以是现实。如果你想对vscode做些个性化的配置，你可以开发自定义主题、图标主题、欢迎页面、自定义左侧的面板（例如资源管理器栏那种）等。你还可以自己定义命令、快捷键、自动补全、菜单等来提升你的开发效率。甚至你可以对现有语言做扩展或者定义新的语言的支持。</p><h2 id="创建插件项目"><a href="#创建插件项目" class="headerlink" title="创建插件项目"></a>创建插件项目</h2><p>首先安装官方的脚手架</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装脚手架</span></span><br><span class="line">npm install -g yo generator-code</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建项目</span></span><br><span class="line">yo code </span><br><span class="line"><span class="comment">// 会一路提示你 输入插件名 插件id 等等。根据需要填写</span></span><br></pre></td></tr></table></figure><p>微软提供了两种方式去开发，一种是 JavaScript 和 TypeScript 去开发，可以根据自己的习惯选择。创建好后按 F5 会打开调试用的vscode窗口来调试插件</p><p>使用 JavaScript 生成的项目结构，<br>├── .vscode<br>│ ├── launch.json // 插件加载和调试的配置<br>│ └── tasks.json // 配置TypeScript编译任务<br>├── .gitignore // 忽略构建输出和node_modules文件<br>├── README.md // 插件文档<br>├── CHANGELOG.md // 插件更新日志<br>├── extension.ts // 插件源代码<br>├── package.json // 插件配置清单<br>├── jsconfig.json //</p><p>先看下入口文件，入口文件需要导出两个函数 activate 和 deactivate</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//extension.js 文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 插件激活调用，也是插件的入口</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Congratulations, your extension "vscode-demo" is now active!'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册一个命令</span></span><br><span class="line">    <span class="keyword">let</span> disposable = vscode.commands.registerCommand(<span class="string">'vscode-demo.helloWorld'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//命令触发是调用</span></span><br><span class="line">        vscode.window.showInformationMessage(<span class="string">'Hello World from vscode-demo!'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    context.subscriptions.push(disposable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插件销毁调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deactivate</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    activate,</span><br><span class="line">    deactivate</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个初始化插件项目，默认就是注册了个hello world 命令，然后运行命令显示hello world的通知，按F5运行项目，在命令面板输入hello world，可以看到右下角弹出通知<br><img src="/images/posts/vscode_extension/20210615205632.png" alt="项目结构"><br><img src="/images/posts/vscode_extension/20210615205655.png" alt="项目结构"></p><h2 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h2><p>vscode 插件的 package.json 是 npm 的一个超集，插件的图标、命令注册、菜单配置、语言注册、主题注册、代码片段等一系列的都需要在这个文件里配置。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"vscode-demo"</span>,</span><br><span class="line">    <span class="attr">"displayName"</span>: <span class="string">"vscode-demo"</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">    <span class="attr">"publisher"</span>: <span class="string">""</span>, <span class="comment">//发布者id，后面会讲怎么发布到插件市场</span></span><br><span class="line">    <span class="attr">"engines"</span>: &#123; <span class="comment">//vscode 最低版本</span></span><br><span class="line">        <span class="attr">"vscode"</span>: <span class="string">"^1.57.0"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"categories"</span>: [ <span class="comment">//插件市场的分类 可以设置成语言主题等其他类型</span></span><br><span class="line">        <span class="string">"Other"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"activationEvents"</span>: [ <span class="comment">//扩展的激活事件</span></span><br><span class="line">        <span class="string">"onCommand:vscode-demo.helloWorld"</span>, <span class="comment">//调用命令时激活</span></span><br><span class="line">        <span class="string">"onLanguage:python"</span>, <span class="comment">//py时激活插件</span></span><br><span class="line">        <span class="string">"workspaceContains:**/.editorconfig"</span>,<span class="comment">// 文件夹打开时激活</span></span><br><span class="line">        <span class="string">"onDebug"</span>,<span class="comment">//调试前激活</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="string">"*"</span> <span class="comment">//启动时候激活，使用这个不需要设置其他的</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"main"</span>: <span class="string">"./extension.js"</span>, <span class="comment">//指定插件入口文件</span></span><br><span class="line">    <span class="attr">"icon"</span>: <span class="string">""</span>, <span class="comment">//插件图标</span></span><br><span class="line">    <span class="attr">"contributes"</span>: &#123; <span class="comment">//大部分的配置都要在这里配置</span></span><br><span class="line">        <span class="attr">"commands"</span>:[], <span class="comment">//配置命令,如果需要暴露给用户使用的需要在这里配置</span></span><br><span class="line">        <span class="attr">"menus"</span>:[], <span class="comment">//配置菜单</span></span><br><span class="line">        <span class="attr">"submenus"</span>:[], <span class="comment">//配置子菜单会用到</span></span><br><span class="line">        <span class="attr">"languages"</span>: [], <span class="comment">//配置语言</span></span><br><span class="line">        <span class="attr">"grammars"</span>:[], <span class="comment">//为语言配置TextMate语法</span></span><br><span class="line">        <span class="attr">"keybindings"</span>:[], <span class="comment">//配置快捷键</span></span><br><span class="line">        <span class="attr">"snippets"</span>:[], <span class="comment">//配置代码片段</span></span><br><span class="line">        <span class="attr">"themes"</span>:[], <span class="comment">//配置主题</span></span><br><span class="line">        <span class="attr">"views"</span>:[], <span class="comment">//配置活动栏视图</span></span><br><span class="line">        <span class="attr">"viewsWelcome"</span>:[], <span class="comment">//配置左侧视图欢迎页</span></span><br><span class="line">        <span class="attr">"viewsContainers"</span>:[], <span class="comment">//配置视图容器</span></span><br><span class="line">        <span class="attr">"configuration"</span>:&#123;&#125;,  <span class="comment">//配置插件配置</span></span><br><span class="line">        <span class="attr">"configurationDefaults"</span>:&#123;&#125;, <span class="comment">//配置插件默认配置</span></span><br><span class="line">        <span class="attr">"colors"</span>:&#123;&#125;,</span><br><span class="line">        <span class="attr">"problemMatchers"</span>:&#123;&#125;,</span><br><span class="line">        <span class="attr">"taskDefinitions"</span>:&#123;&#125;,</span><br><span class="line">        <span class="attr">"typescriptServerPlugins"</span>:&#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="命令示例"><a href="#命令示例" class="headerlink" title="命令示例"></a>命令示例</h2><p>一般提供给被人使用的功能都是通过命令注册，在命令的回调函数里处理相关功能逻辑，然后就可以在vscode 的命令面板调用相关命令。你也可以注册快捷键、菜单等和命令绑定在一起来触发命令。VS Code 内部含有大量和编辑器交互、控制UI、后台操作的内置命令给我们使用。</p><h3 id="注册命令"><a href="#注册命令" class="headerlink" title="注册命令"></a>注册命令</h3><p>vscode 在 commands 下提供了 <strong>registerCommand</strong> 和 <strong>registerTextEditorCommand</strong>用来注册命令，registerTextEditorCommand 注册的命令只会在编辑器激活的时候才调用。</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在activate函数注册命令</span></span><br><span class="line"></span><br><span class="line">context.subscriptions.push(</span><br><span class="line">    <span class="comment">// 第一个参数为命令ID,第二次参数命令回调函数</span></span><br><span class="line">    vscode.commands.registerCommand(<span class="string">'vscode-demo.currentText'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 获取当前激活的编辑器</span></span><br><span class="line">        <span class="keyword">let</span> currentEditor = vscode.window.activeTextEditor; </span><br><span class="line">        <span class="comment">// 获取编辑器选择的内容</span></span><br><span class="line">        <span class="built_in">console</span>.log(currentEditor.document.getText(currentEditor.selection));</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>命令注册后默认是不会对外提供的，如果需要提供给用户使用还需要在 <strong>package.json</strong> 的 <strong>contributes.commands</strong> 添加相应配置</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"contributes"</span>: &#123;</span><br><span class="line">        <span class="attr">"commands"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"command"</span>: <span class="string">"vscode-demo.currentText"</span>,</span><br><span class="line">                <span class="attr">"title"</span>: <span class="string">"获取选择文本"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>按住 F5 运行插件，在命令面板输入 <em>获取选择文本</em> ,会发现报错了。是因为 <strong>activationEvents</strong> 配置里只配置了 “onCommand:vscode-demo.helloWorld” 才会激活插件，我们需要把新加的命令也加入进去，或者改为 *</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    activationEvents: [ "*" ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><p>在 commands 提供了 ** executeCommand ** API用来调用命令，可以使用它调用我们插件里的命令，也可以调用vscode内置的命令。<br>使用示例</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 调用</span></span><br><span class="line">vscode.commands.executeCommand(<span class="string">'vscode-demo.helloWorld'</span>)</span><br></pre></td></tr></table></figure><h2 id="菜单示例"><a href="#菜单示例" class="headerlink" title="菜单示例"></a>菜单示例</h2><p>package.json 中的 <strong>contributes.menus</strong> 用来的配置菜单项，下面这些编辑器可以配置菜单的地方.</p><ul><li>全局命令面板 - commandPalette</li><li>资源管理器上下文菜单 - explorer/context</li><li>编辑器上下文菜单 - editor/context</li><li>编辑器标题栏 - editor/title</li><li>编辑器标题上下文菜单 - editor/title/context</li><li>调试栈视图的上下文菜单 - debug/callstack/context</li><li>视图的标题菜单 - view/title</li><li>视图项的菜单 - view/item/context</li><li>SCM 标题菜单 - scm/title</li><li>SCM 资源组 - scm/resourceGroup/context</li><li>SCM 资源 - scm/resource/context</li><li>SCM 改变标题 - scm/change/title</li></ul><p>配置菜单需要提供 选中菜单时执行的命令和菜单出现的条件。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"命令"</span>,</span><br><span class="line">    <span class="attr">"when"</span>: <span class="string">"条件"</span>,</span><br><span class="line">    <span class="attr">"alt"</span>: <span class="string">"可选命令"</span>,</span><br><span class="line">    <span class="attr">"group"</span>: <span class="string">"菜单分组"</span>,</span><br><span class="line">    <span class="attr">"submenu"</span>: <span class="string">"配置二级菜单"</span>,</span><br><span class="line">    <span class="attr">"icon"</span>: <span class="string">"图标"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="控制命令面板的命令"><a href="#控制命令面板的命令" class="headerlink" title="控制命令面板的命令"></a>控制命令面板的命令</h3><p>默认情况下注册的命令都会显示在命令面板中，有时候需要更具条件显示，就可以在 <strong>commandPalette</strong> 配置指定命令然后通过 <strong>when</strong> 控制。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"contributes"</span>: &#123;</span><br><span class="line">        <span class="attr">"commands"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"command"</span>: <span class="string">"vscode-demo.currentText"</span>,</span><br><span class="line">                <span class="attr">"title"</span>: <span class="string">"获取选择文本"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"menus"</span>: &#123;</span><br><span class="line">            <span class="attr">"commandPalette"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"command"</span>: <span class="string">"vscode-demo.currentText"</span>,</span><br><span class="line">                    <span class="attr">"title"</span>: <span class="string">"获取选择文本"</span>,</span><br><span class="line">                    <span class="attr">"when"</span>: <span class="string">"editorHasSelection"</span> <span class="comment">// 只有选择文本才显示</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="when-条件"><a href="#when-条件" class="headerlink" title="when 条件"></a>when 条件</h3><p>when提供的逻辑操作符有 ==、!=、||、&amp;&amp;、!、=~(正则)、&gt;、&gt;=、&lt;、&lt;=、in 等操作符，和js的类似，多了一个 <strong>=~</strong> 符匹配正则。vscode 还提供了很多上下文可以和这些操作符组合使用。<a href="https://code.visualstudio.com/api/references/when-clause-contexts" target="_blank" rel="noopener">查看上下文详情</a><br>示例</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;when&quot;:&quot;resourceExtname !&#x3D; .js&quot; &#x2F;&#x2F;不是js文件时</span><br><span class="line">&quot;when&quot;:&quot;editorHasSelection&quot; &#x2F;&#x2F;选择文本才显示</span><br><span class="line">&quot;when&quot;:&quot;!editorHasSelection&quot; &#x2F;&#x2F;不选择文本才显示</span><br></pre></td></tr></table></figure><h3 id="配置多级菜单"><a href="#配置多级菜单" class="headerlink" title="配置多级菜单"></a>配置多级菜单</h3><p>使用<strong>submenu</strong>指定父级菜单的ID，<strong>submenus</strong>配置父级菜单名称等信息。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"contributes"</span>: &#123;</span><br><span class="line">        <span class="attr">"menus"</span>: &#123;</span><br><span class="line">            <span class="attr">"editor/context"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"command"</span>: <span class="string">"vscode-demo.currentText"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"submenu"</span>: <span class="string">"first.menu"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"first.menu"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"command"</span>: <span class="string">"vscode-demo.currentText"</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"submenu"</span>: <span class="string">"two.menu"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"two.menu"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"command"</span>: <span class="string">"vscode-demo.currentText"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"submenus"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"first.menu"</span>,</span><br><span class="line">                <span class="attr">"label"</span>: <span class="string">"一级菜单"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"two.menu"</span>,</span><br><span class="line">                <span class="attr">"label"</span>: <span class="string">"二级菜单"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/posts/vscode_extension/20210616211914.png" alt="示例"></p><h3 id="分组排序"><a href="#分组排序" class="headerlink" title="分组排序"></a>分组排序</h3><p>菜单项可以通过组来分类。根据下列默认规则，然后按照字母排序，</p><ul><li>编辑器上下文菜单(editor/context)默认有这些分组：<ul><li>navigation - navigation组始终在最上方。</li><li>1_modification - 紧接上一个组，这个组包含可以修改你代码的命令。</li><li>9_cutcopypaste - 然后是基础编辑命令。</li><li>z_commands - 最后一个分组则是命令面板入口。</li></ul></li><li>资源管理器上下文菜单(explorer/context)默认有下列分组：<ul><li>navigation - 在VS Code中导航的相关命令。navigation组始终在最上方。</li><li>2_workspace - 和工作区操作相关的命令。</li><li>3_compare - 比较文件和diff相关的命令。</li><li>4_search - 在搜索视图中和搜索相关的命令。</li><li>5_cutcopypaste - 和剪切、复制、粘贴文件相关的命令。</li><li>7_modification - 修改文件的相关命令。</li></ul></li><li>编辑器标签菜单默认有下列分组<ul><li>1_close - 和关闭编辑器相关的命令。</li><li>3_preview - 和固定编辑器相关的命令。</li></ul></li><li>编辑器标题栏(editor/title)的默认分组<ul><li>1_diff - 与使用差异编辑器相关的命令。</li><li>3_open - 与打开编辑器相关的命令。</li><li>5_close - 与关闭编辑器相关的命令。</li></ul></li></ul><p>组内的菜单顺序取决于标题或者序号属性。菜单的组内顺序由@<number>加到group值的后面得以确定：</number></p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"editor/title": [&#123;</span><br><span class="line">    "when": "editorHasSelection",</span><br><span class="line">    "command": "extension.Command",</span><br><span class="line">    "group": "myGroup@1"</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><h2 id="注册快捷键"><a href="#注册快捷键" class="headerlink" title="注册快捷键"></a>注册快捷键</h2><p>快捷键还是比较简单的，Windows和Linux 是key指定，macOS使用mac指定的快捷键。</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">"contributes": &#123;</span><br><span class="line">    "keybindings": [&#123;</span><br><span class="line">        "command": "vscode-demo.currentText", //快捷键绑定命令</span><br><span class="line">        "key": "ctrl+f1", </span><br><span class="line">        "mac": "cmd+f1",</span><br><span class="line">        "when": "editorHasSelection" // 出现时机</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>设置好后，使用了对应命令的菜单项也会显示对应快捷键，如图所示<br><img src="/images/posts/vscode_extension/20210616230737.png" alt="示例"></p><div class="post-content-tag"><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-tag"></use></svg> <a class="_pjax" href="/tags/vscode"><span>vscode</span></a></div></div></article><div id="share_container"><div></div><div></div><div></div><div></div></div><div class="prev-next-content"><div class="btn-prev"><div><i class="iconfont cg-shangyige"></i> 上一篇</div><a class="_pjax" href="/vscode_extension_two/">vscode 插件开发指北 (二)</a></div><div class="btn-next"><div>下一篇 <i class="iconfont cg-xiayige"></i></div><a class="_pjax" href="/flutter_animation/">Flutter 中的动画</a></div></div></main></div></div><footer class="layout-footer"><div>© 2019 - <span itemprop="copyrightYear">2021</span> 白云苍狗.</div><div>由<a> Hexo </a>强力驱动; Theme by <a href="//github.com/MaLuns/MalBlog/tree/master/themes/hexo-theme-simple" target="_blank">hexo-theme-simple </a>;</div><div>博客已萌萌哒运行: <span id="since"></span> <span class="my-face">(●'◡'●)ﾉ♥</span></div></footer><div id="aplayer-fixed"></div><script type="text/javascript">function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("11/19/2019 17:00:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=Math.floor(e_hrsold),e_minsold=60*(e_hrsold-hrsold),minsold=Math.floor(60*(e_hrsold-hrsold)),seconds=Math.floor(60*(e_minsold-minsold)),since.innerHTML=daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}show_date_time()</script><div class="float-action-buttons"><com-tips dir="left" tips="回到顶部" style="display:block" class="backtop"><button type="button" class="btn shadow" id="back-top"><i class="iconfont cg-backtop"></i></button></com-tips><com-tips dir="left" tips="昼夜切换" style="display:block"><button type="button" class="btn shadow" id="lightBtn"><i class="iconfont cg-rijian"></i> <i class="iconfont cg-zhanghu-heiye"></i></button></com-tips><com-popover><com-tips dir="left" tips="设置"><button type="button" class="btn shadow" id="setbtn"><i class="iconfont cg-shezhi"></i></button></com-tips><com-popcon u-none><div id="settingsPopup" class="shadow"><div class="settings-item"><div class="settings-item-lable">夜间模式</div><com-switch id="lightSwitch"></com-switch></div><div class="settings-item"><div class="settings-item-lable">字体</div><com-radio-group id="fontFamily" defaultvalue="sans-serif"><com-radio value="sans-serif">sans-serif</com-radio><com-radio value="serif">serif</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">阴影</div><com-radio-group id="boxShadowBlur" defaultvalue="5"><com-radio value="0">无</com-radio><com-radio value="5">浅</com-radio><com-radio value="15">深</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">滤镜</div><com-radio-group id="filterColor" defaultvalue="none"><com-radio value="none">关闭</com-radio><com-radio value="sunset">日落</com-radio><com-radio value="sunrise">日出</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">圆角</div><com-slider id="radiusSlider" showtips suffix="px" min="0" max="20"></com-slider></div></div></com-popcon></com-popover><com-tips dir="left" tips="菜单" class="aside-menu"><button type="button" class="btn shadow" id="asideMenu"><i class="iconfont cg-menu"></i></button></com-tips></div><script type="text/javascript">(window.ActiveXObject||"ActiveXObject"in window)&&(document.body.innerHTML="<h2 style='text-align:center; line-height:100px; font-weight:700;'>为了更好的体验,请使用非IE浏览器</h2><footer class='layout-footer'><div>© 2019 - <span itemprop='copyrightYear'>2020</span> 白云苍狗.</div><div>由<a> Hexo </a>强力驱动; Theme by <a href='//github.com/MaLuns/MalBlog/tree/master/themes/hexo-theme-simple' target='_blank'>hexo-theme-simple </a>;</div><div>博客已萌萌哒运行: <span id='since'>379天22小时55分55秒</span> <span class='my-face'>(●'◡'●)ﾉ♥</span></div></footer>");var CONFIG={favicon:{visibilitychange:JSON.parse("true"),narmal:"/images/favicon.png",hidden:"/images/failure.png",show_text:"(/≧▽≦/)咦！又好了！",hide_text:"(●—●)喔哟，崩溃啦！"}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/MoePlayer/APlayer@1.10.1/dist/APlayer.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script><script type="text/javascript" src="//at.alicdn.com/t/font_1518765_5jbj7btfht2.js"></script><script type="text/javascript" src="//imgcache.qq.com/qcloud/tcbjs/1.6.0/tcb.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script src="/js/index.min.js?v=0.2.10.js"></script><script>"serviceWorker"in navigator?navigator.serviceWorker.register("/sw.js").then(function(){navigator.serviceWorker.controller?console.log("Assets cached by the controlling service worker."):console.log("Please reload this page to allow the service worker to handle network operations.")}).catch(function(e){console.log("ERROR: "+e)}):console.log("Service workers are not supported in the current browser.")</script></body></html>