<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="x5-fullscreen" content="true"><meta name="full-screen" content="yes"><meta name="theme-color" content="#317EFB"><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=0" name="viewport"><meta name="keywords" content="build,devenv,csc.exe,MSbuild,C#,.Net,JavaScript,HTML,CSS"><meta name="description" content="想要实现自动化编译并生产打包替换文件,首要的对项目进行编译生成.一般编译 donnet 项目有三种方式 csc.exe , MSbuild(不需要安装vs) , devenv(需要安装vs).因为自己已经安装了vs了,所以直接使用devenv去编译程序了"><meta property="og:type" content="article"><meta property="og:title" content="基于 devenv 实现自动化编译,生成测试文件"><meta property="og:url" content="https://www.imalun.com/aotubuild/index.html"><meta property="og:site_name" content="白云苍狗"><meta property="og:description" content="想要实现自动化编译并生产打包替换文件,首要的对项目进行编译生成.一般编译 donnet 项目有三种方式 csc.exe , MSbuild(不需要安装vs) , devenv(需要安装vs).因为自己已经安装了vs了,所以直接使用devenv去编译程序了"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.imalun.com/images/logo/aotubuild_logo.png"><meta property="article:published_time" content="2020-01-02T10:16:09.000Z"><meta property="article:modified_time" content="2021-07-16T05:23:20.737Z"><meta property="article:author" content="白云苍狗"><meta property="article:tag" content="build"><meta property="article:tag" content="devenv"><meta property="article:tag" content="csc.exe"><meta property="article:tag" content="MSbuild"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.imalun.com/images/logo/aotubuild_logo.png"><meta name="description" content="学习.Net,前端时长三年的,程序猿"><title>白云苍狗 - 基于 devenv 实现自动化编译,生成测试文件</title><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=0.2.10"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="canonical" href="https://www.imalun.com/aotubuild/"><link rel="stylesheet" href="//at.alicdn.com/t/font_1518765_5jbj7btfht2.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/MoePlayer/APlayer@1.10.1/dist/APlayer.min.css"><link rel="stylesheet" href="/css/index.css?v=0.2.10.css"><script type="text/javascript">~function () {
            let setting = localStorage.getItem('setting') ? JSON.parse(localStorage.getItem('setting')) : {};
            let root = document.documentElement;
            for (let key in setting) {
                if (key === 'lightSwitch') {
                    root.classList[setting[key] ? 'add' : 'remove']('dark')
                } else if(key === 'themeColorPicker'){

                } else {
                    setting[key].css.forEach(item => { root.style.setProperty(item.key, item.val); })
                }
            }
        }();</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="白云苍狗" type="application/atom+xml"></head><body><div class="page-img-bg"></div><header class="layout-header"><button type="button" class="header-menu-btn"><i class="iconfont cg-toggle"></i></button><nav class="nav"><li><a data-pjax class="_pjax" href="/">白云苍狗</a></li><li><a data-pjax class="_pjax" href="/archives"><i class="iconfont cg-shijian"></i> 归档</a></li><li><a data-pjax class="_pjax" href="/links"><i class="iconfont cg-links"></i> 友情链接</a></li></nav></header><div class="layout-content"><header class="layout-content-header"><div class="shape"><span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></div><div class="banner" data-text="白云苍狗" data-interval="100"><div class="title-inner">白云苍狗</div><div class="user-des"><span style="width:55em;animation:typing 10s steps(55),caret .5s steps(1) infinite">「一觉游仙好梦，任它竹冷松寒。轩辕事，古今谈，风流河山。沉醉负白首，舒怀成大观。醒，亦在人间；梦，亦在人间」</span></div></div></header><div class="layout-content-content"><aside id="layout-content-aside" class="layout-content-aside"><div class="aside-nav-card shadow"><header><h2>白云苍狗</h2><p>亦在人间</p></header><ul><a href="/" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-home"></use></svg> 首页</li></a><a href="/links" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-links"></use></svg> 友情链接</li></a><a href="/comment" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-comment"></use></svg> 留言</li></a><a href="/atom.xml" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-rss"></use></svg> RSS</li></a><a href="//github.com/MaLuns" target="_blank" rel="noopener" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-github"></use></svg> Github</li></a><a href="//gitee.com/ml13" target="_blank" rel="noopener" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-gitee"></use></svg> Gitee</li></a><a href="tencent://message/?uin=384399021&amp;Site=有事Q我&amp;Menu=yes"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-qq"></use></svg> 联系我</li></a></ul></div><div class="user-card shadow"><img src="/images/avatar.jpg" alt="" class="avatar"><div><p style="margin:20px">醒，亦在人间；梦，亦在人间</p><div class="post-state"><div><span class="item-count">24 </span><span>文章</span></div><div><span class="item-count">3 </span><span>分类</span></div><div><span class="item-count">21 </span><span>标签</span></div></div></div><div id="post-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SVN-更新提交文件"><span class="toc-number">1.</span> <span class="toc-text">SVN 更新提交文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动态去修改程序版本和日期"><span class="toc-number">2.</span> <span class="toc-text">动态去修改程序版本和日期</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用-devenv-进行编译"><span class="toc-number">3.</span> <span class="toc-text">使用 devenv 进行编译</span></a></li></ol></div></div></aside><div id="sidebar-mask"></div><main id="main" class="layout-content-main"><article class="shadow animated fadeInUp"><header class="post-header"><div class="post-container"><h2 class="post-title">「基于 devenv 实现自动化编译,生成测试文件」</h2><div class="post-meta"><div><span class="post-push-time"><time datetime="2020-01-02T10:16:09.000Z" title="2020-01-02T10:16:09.000Z" itemprop="datePublished"><i class="iconfont cg-shijian"></i> 2020-01-02 </time><span class="post-meta-divider">•</span> </span><span><i class="iconfont cg-tag1"></i> 记录类 <span class="post-meta-divider">•</span> </span><span><i class="iconfont cg-tag1"></i> <a class="_pjax" href="/categories/记录类">记录类</a></span></div><span class="post-wordcount"><span class="post-meta-item-text"><i class="iconfont cg-wendang"></i> 共1.9k字 </span><span class="post-meta-divider">•</span> </span><span class="post-consuming-time"><span class="post-meta-item-text"><i class="iconfont cg-shalou"></i> 约9分钟</span></span></div></div></header><div id="nice" class="post-content post-content-detail"><p>想要实现自动化编译并生产打包替换文件,首要的对项目进行编译生成.一般编译 donnet 项目有三种方式 csc.exe , MSbuild(不需要安装vs) , devenv(需要安装vs).因为自己已经安装了vs了,所以直接使用devenv去编译程序了</p><a id="more"></a><p>大致流程如下</p><p><img src="/images/posts/aotubuild/20200102105829.png" alt=""></p><h1 id="SVN-更新提交文件"><a href="#SVN-更新提交文件" class="headerlink" title="SVN 更新提交文件"></a>SVN 更新提交文件</h1><p>SVN 工具使用TortoiseSVN. 为了简化操这里直接使用 TortoiseProc.exe(TortoiseSVN的GUI程序) 所提供的命令行,对项目进行更新等操作<br>使用Demo</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TortoiseProc.exe &#x2F;command:commit</span><br><span class="line">                 &#x2F;path:&quot;c:\svn_wc\file1.txt*c:\svn_wc\file2.txt&quot;</span><br><span class="line">                 &#x2F;logmsg:&quot;test log message&quot; &#x2F;closeonend:2</span><br><span class="line"></span><br><span class="line">参数大概意思</span><br><span class="line"></span><br><span class="line">&#x2F;closeonend:2 如果没发生错误和冲突则自动关闭对话框</span><br><span class="line">&#x2F;command    执行的操作</span><br><span class="line">        :update 更新</span><br><span class="line">        :commit 提交</span><br><span class="line">&#x2F;path   路径</span><br><span class="line">&#x2F;logmsg 提交备注信息</span><br></pre></td></tr></table></figure><p>具体的使用方式可以在 TortoiseSVN 提供帮助文档里去查看</p><p><img src="/images/posts/aotubuild/20200102174220.png" alt=""></p><h1 id="动态去修改程序版本和日期"><a href="#动态去修改程序版本和日期" class="headerlink" title="动态去修改程序版本和日期"></a>动态去修改程序版本和日期</h1><p>因为项目的日期和版本是写死在了程序里的,每次给测试生产替换文件时候都得去修改程序日期.大致思路是通过正则去修改文件.考虑到需要后面可能需要修改的地方较多,目前是通过Json去配置需要修改文件 和 对应正则 和 调用的方法(获取的值).为了提供修改灵活性,目前是通过 CSharpCodeProvider 去编译 C# 文件,来方便随时修改获取新的值得规则</p><p>大致流程如下<br><img src="/images/posts/aotubuild/20200102162138.png" alt=""></p><p>json 配置文件如下</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"FilePath"</span>: <span class="string">"C:\\Test.cs"</span>,<span class="comment">//路径</span></span><br><span class="line">    <span class="attr">"Pattern"</span>: <span class="string">".* string SerEdition .*"</span>,<span class="comment">//正则规则</span></span><br><span class="line">    <span class="attr">"FunctionName"</span>: <span class="string">"GetEditDataTime"</span>, <span class="comment">//以及需要调用的方法</span></span><br><span class="line">    <span class="attr">"Params"</span>: [] <span class="comment">//参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>假如 Test.cs 文件需要修改内如下</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static string SerVer &#x3D; &quot;V7.6.0&quot;;</span><br><span class="line"></span><br><span class="line">public static string SerEdition &#x3D; &quot;2019.12.25&quot;;</span><br></pre></td></tr></table></figure><p>新增一个 Units.cs(用于动态编译) 文件,生成操作改为内容,不参与编译</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;Units.cs 文件</span><br><span class="line"></span><br><span class="line">using System;</span><br><span class="line">namespace DynamicRunCode</span><br><span class="line">&#123;</span><br><span class="line">    public class Units</span><br><span class="line">    &#123;</span><br><span class="line">        public string GetEditDataTime()</span><br><span class="line">        &#123;</span><br><span class="line">            return &quot;        public static string SerEdition &#x3D; \&quot;&quot; + DateTime.Now.ToString(&quot;yyyy.MM.dd&quot;) + &quot;\&quot;;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 可自己在这添加方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对 CSharpCodeProvider 进行简单封装,CSharpRunCode 类 主要是对 C# 字符串进行编译,和提供一个可以调用 C# 字符串中方法</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class CSharpRunCode</span><br><span class="line">&#123;</span><br><span class="line">    CompilerResults cr;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 编译 C# Code 字符串</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;param name&#x3D;&quot;csharpStr&quot;&gt;&lt;&#x2F;param&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;returns&gt;返回编译结果&lt;&#x2F;returns&gt;</span><br><span class="line">    public CSharpRunCode (string csharpStr)</span><br><span class="line">    &#123;</span><br><span class="line">        CSharpCodeProvider cs &#x3D; new CSharpCodeProvider();</span><br><span class="line">        CompilerParameters cp &#x3D; new CompilerParameters</span><br><span class="line">        &#123;</span><br><span class="line">            GenerateInMemory &#x3D; true,&#x2F;&#x2F;设定在内存中创建程序集</span><br><span class="line">            GenerateExecutable &#x3D; false&#x2F;&#x2F;设定是否创建可执行文件,也就是exe文件或者dll文件</span><br><span class="line">        &#125;;</span><br><span class="line">        cr &#x3D; cs.CompileAssemblyFromSource(cp, csharpStr);</span><br><span class="line">        if (cr.Errors.HasErrors)</span><br><span class="line">        &#123;</span><br><span class="line">            foreach (CompilerError item in cr.Errors)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(item.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 调用方法</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;param name&#x3D;&quot;typeName&quot;&gt;&lt;&#x2F;param&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;param name&#x3D;&quot;functionName&quot;&gt;&lt;&#x2F;param&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;param name&#x3D;&quot;pars&quot;&gt;&lt;&#x2F;param&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;returns&gt;&lt;&#x2F;returns&gt;</span><br><span class="line">    public object RunFunctino(string typeName, string functionName, params object[] pars)</span><br><span class="line">    &#123;</span><br><span class="line">        Assembly ass &#x3D; cr.CompiledAssembly;</span><br><span class="line">        object obj &#x3D; ass.CreateInstance(typeName);</span><br><span class="line">        MethodInfo mi &#x3D; obj.GetType().GetMethod(functionName);</span><br><span class="line">        return mi.Invoke(obj, pars);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用方法</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;FunctionName 配置中函数名</span><br><span class="line">&#x2F;&#x2F;FilePath 文件路径</span><br><span class="line">&#x2F;&#x2F;Pattern 正则规则</span><br><span class="line"></span><br><span class="line">CSharpRunCode runCode &#x3D; new CSharpRunCode(File.ReadAllText(&quot;xxx\\Units.cs&quot;));</span><br><span class="line">string result &#x3D; (string)runCode.RunFunctino(&quot;DynamicRunCode.Units&quot;, FunctionName);</span><br><span class="line">string fileText &#x3D; File.ReadAllText(FilePath);</span><br><span class="line">List&lt;string&gt; fileTextArr &#x3D; File.ReadAllLines(FilePath).ToList();</span><br><span class="line">var matches &#x3D; Regex.Matches(fileText, Pattern);</span><br><span class="line">File.WriteAllText(FilePath, Regex.Replace(fileText, Pattern, result));</span><br><span class="line"></span><br><span class="line">Console.WriteLine($&quot;&#123;Environment.NewLine&#125;文件路径:【&#123;FilePath&#125;】&quot;);</span><br><span class="line">Console.WriteLine($&quot;替换【&#123;matches.Count&#125;】处&quot;);</span><br><span class="line">Console.ForegroundColor &#x3D; ConsoleColor.Yellow;</span><br><span class="line"></span><br><span class="line">foreach (Match match in matches)</span><br><span class="line">&#123;</span><br><span class="line">    int rowNum &#x3D; fileTextArr.FindIndex(t &#x3D;&gt; t.Contains(match.Value.Trim()));</span><br><span class="line">    if (rowNum&gt;-1)</span><br><span class="line">    &#123;</span><br><span class="line">        fileTextArr[rowNum]&#x3D;&quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine($&quot;原值:【&#123;match.Value.Replace(&quot;\r&quot;, &quot;&quot;)&#125;】行号:【&#123;rowNum + 1&#125;】&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Console.ForegroundColor &#x3D; ConsoleColor.Green;</span><br><span class="line">Console.WriteLine($&quot;新值:【&#123;result&#125;】&quot;);</span><br><span class="line">Console.ForegroundColor &#x3D; ConsoleColor.White;</span><br></pre></td></tr></table></figure><p>执行结果<br><img src="/images/posts/aotubuild/20200102163249.png" alt=""></p><h1 id="使用-devenv-进行编译"><a href="#使用-devenv-进行编译" class="headerlink" title="使用 devenv 进行编译"></a>使用 devenv 进行编译</h1><p>VS 安装的是2017,devenv 正常路径应该是 [C:\Program Files (x86)\Microsoft Visual Studio\2017\Professional\Common7\IDE] 下,网上一堆动态查找 devenv 路径的方法.最后感觉通过注册表方式比较靠谱,<a href="https://www.cnblogs.com/lovecsharp094/p/8952327.html" target="_blank" rel="noopener">参考这篇</a><br><img src="/images/posts/aotubuild/20200102152424.png" alt=""></p><p>具体实现</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class DevenvOpt</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 是否安装VS</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">    public bool IsFindDevenv &#123; get; set; &#125; &#x3D; false;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; devenv 路径</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">    public string DevenvExePath &#123; get; set; &#125;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; devenv 所在目录路径</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">    public string DevenvDirPath &#123; get; set; &#125;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; 版本</span><br><span class="line">    &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">    public int Version &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">    public DevenvOpt()</span><br><span class="line">    &#123;</span><br><span class="line">        string path &#x3D; FindDevenv();</span><br><span class="line">        if (!string.IsNullOrWhiteSpace(path))</span><br><span class="line">        &#123;</span><br><span class="line">            IsFindDevenv &#x3D; true;</span><br><span class="line">            DevenvExePath &#x3D; path;</span><br><span class="line">            DevenvDirPath &#x3D; path.Replace(&quot;devenv.exe&quot;, &quot;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private string FindDevenv()</span><br><span class="line">    &#123;</span><br><span class="line">        string registryPath &#x3D; @&quot;SOFTWARE\Wow6432Node\Microsoft\VisualStudio\SxS\VS7&quot;;</span><br><span class="line">        var localMachineRegistry &#x3D; RegistryKey.OpenBaseKey(RegistryHive.LocalMachine, Environment.Is64BitOperatingSystem ? RegistryView.Registry64 : RegistryView.Registry32);</span><br><span class="line">        Dictionary&lt;string, string&gt; vsPaths &#x3D; ReadRegistryInfo(localMachineRegistry, registryPath);</span><br><span class="line">        string highestVSdevenvPath &#x3D; string.Empty;</span><br><span class="line">        if (vsPaths !&#x3D; null &amp;&amp; vsPaths.Any())</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            var tempVersion &#x3D; 0;</span><br><span class="line">            foreach (KeyValuePair&lt;string, string&gt; kvp in vsPaths)</span><br><span class="line">            &#123;</span><br><span class="line">                var devenvExePath &#x3D; Path.Combine(kvp.Value, @&quot;Common7\IDE\devenv.exe&quot;);</span><br><span class="line">                if (File.Exists(devenvExePath))</span><br><span class="line">                &#123;</span><br><span class="line">                    var currentVersion &#x3D; Convert.ToInt32(kvp.Key.Split(&#39;.&#39;)[0]);</span><br><span class="line">                    if (currentVersion &gt; tempVersion)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Version &#x3D; currentVersion;</span><br><span class="line">                        highestVSdevenvPath &#x3D; devenvExePath;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return highestVSdevenvPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Dictionary&lt;string, string&gt; ReadRegistryInfo(RegistryKey registryKey, string registryInfoPath)</span><br><span class="line">    &#123;</span><br><span class="line">        if (registryKey &#x3D;&#x3D; null || string.IsNullOrEmpty(registryInfoPath)) return null;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            RegistryKey rsg &#x3D; registryKey.OpenSubKey(registryInfoPath, false);</span><br><span class="line">            if (rsg !&#x3D; null)</span><br><span class="line">            &#123;</span><br><span class="line">                var keyNameArray &#x3D; rsg?.GetValueNames();</span><br><span class="line">                var result &#x3D; new Dictionary&lt;string, string&gt;();</span><br><span class="line">                foreach (var name in keyNameArray)</span><br><span class="line">                &#123;</span><br><span class="line">                    string keyValue &#x3D; (string)rsg.GetValue(name);</span><br><span class="line">                    result.Add(name, keyValue);</span><br><span class="line">                &#125;</span><br><span class="line">                rsg.Close();</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        catch</span><br><span class="line">        &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>找到了路径后接下来就是,将路径写入环境变量(或者执行 devenv 先调转到目录),调用CMD然后去执行 devenv 程序去编译项目操作了<br>对调用CMD 简单封装下</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class CMD</span><br><span class="line">&#123;</span><br><span class="line">        private static readonly string CmdPath &#x3D; @&quot;cmd.exe&quot;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">        &#x2F;&#x2F;&#x2F; 执行cmd命令 </span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;param name&#x3D;&quot;cmd&quot;&gt;执行的命令&lt;&#x2F;param&gt;</span><br><span class="line">        public static CMD_RES RunCmd(params string[] cmds)</span><br><span class="line">        &#123;</span><br><span class="line">            CMD_RES res &#x3D; new CMD_RES();</span><br><span class="line"></span><br><span class="line">            using (Process p &#x3D; new Process())</span><br><span class="line">            &#123;</span><br><span class="line">                p.StartInfo.FileName &#x3D; CmdPath;</span><br><span class="line">                p.StartInfo.UseShellExecute &#x3D; false;        </span><br><span class="line">                p.StartInfo.RedirectStandardInput &#x3D; true;   </span><br><span class="line">                p.StartInfo.RedirectStandardOutput &#x3D; true;  </span><br><span class="line">                p.StartInfo.RedirectStandardError &#x3D; true;   </span><br><span class="line">                p.StartInfo.CreateNoWindow &#x3D; true;          </span><br><span class="line">                try</span><br><span class="line">                &#123;</span><br><span class="line">                    p.Start();</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;向cmd窗口写入命令</span><br><span class="line">                    foreach (string cmd in cmds) </span><br><span class="line">                        p.StandardInput.WriteLine(cmd);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;关闭写入流</span><br><span class="line">                    p.StandardInput.Close();</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F;获取cmd窗口的输出信息</span><br><span class="line">                    string output &#x3D; p.StandardOutput.ReadToEnd();</span><br><span class="line">                    string error &#x3D; p.StandardError.ReadToEnd();</span><br><span class="line">                    &#x2F;&#x2F;等待程序执行完退出进程</span><br><span class="line">                    p.WaitForExit();</span><br><span class="line">                    res.ToRes(output, error);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                catch (System.Exception e)</span><br><span class="line">                &#123;</span><br><span class="line">                    System.Console.WriteLine(e.Message);</span><br><span class="line">                &#125;</span><br><span class="line">                finally</span><br><span class="line">                &#123;</span><br><span class="line">                    p.Close();</span><br><span class="line">                    p.Dispose();</span><br><span class="line">                &#125;</span><br><span class="line">                return res;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class CMD_RES</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">        &#x2F;&#x2F;&#x2F; 状态</span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">        public bool State &#123; get; set; &#125; &#x3D; true;</span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">        &#x2F;&#x2F;&#x2F; 输出信息</span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">        public string Text &#123; get; set; &#125;</span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;summary&gt;</span><br><span class="line">        &#x2F;&#x2F;&#x2F; 错误信息</span><br><span class="line">        &#x2F;&#x2F;&#x2F; &lt;&#x2F;summary&gt;</span><br><span class="line">        public string Error &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        public void ToRes(string output, string error)</span><br><span class="line">        &#123;</span><br><span class="line">            State &#x3D; string.IsNullOrWhiteSpace(error);</span><br><span class="line">            Text &#x3D; output;</span><br><span class="line">            Error &#x3D; error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>devenv 具体参数可以参考<a href="https://docs.microsoft.com/zh-CN/visualstudio/ide/reference/devenv-command-line-switches?view=vs-2017" target="_blank" rel="noopener">微软官网文档</a><br>示例</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;DevenvDirPath devenv 所在目录</span><br><span class="line">CMD_RES res &#x3D; CMD.RunCmd(&quot;@echo off &quot;, $&quot;&#123;DevenvDirPath.Substring(0,1)&#125;:&quot;,$&quot;cd &#123;DevenvDirPath&#125;&quot;,$&quot;devenv 项目路径  &#x2F;rebuild Release&quot;);</span><br></pre></td></tr></table></figure><p>devenv 回输出,然后判断是否全部编译成功</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">成功x个        失败x个        跳过x个</span><br></pre></td></tr></table></figure><p>文件编译好之后,就是对文件的拷贝操作了这里就不描述了</p><p>效果如下<br><img src="/images/posts/aotubuild/20200102175312.png" alt=""></p><div class="post-content-tag"><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-tag"></use></svg> <a class="_pjax" href="/tags/devenv"><span>devenv</span></a></div></div></article><div id="share_container"><div></div><div></div><div></div><div></div></div><div class="prev-next-content"><div class="btn-prev"><div><i class="iconfont cg-shangyige"></i> 上一篇</div><a class="_pjax" href="/js_prototype/">JavaScript中的 [[prototype]]、prototype、__proto__ 关系</a></div><div class="btn-next"><div>下一篇 <i class="iconfont cg-xiayige"></i></div><a class="_pjax" href="/jsasync/">深入理解 JavaScript 事件（ 第1章 ）</a></div></div></main></div></div><footer class="layout-footer"><div>© 2019 - <span itemprop="copyrightYear">2021</span> 白云苍狗.</div><div>由<a> Hexo </a>强力驱动; Theme by <a href="//github.com/MaLuns/MalBlog/tree/master/themes/hexo-theme-simple" target="_blank">hexo-theme-simple </a>;</div><div>博客已萌萌哒运行: <span id="since"></span> <span class="my-face">(●'◡'●)ﾉ♥</span></div></footer><div id="aplayer-fixed"></div><script type="text/javascript">function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("11/19/2019 17:00:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=Math.floor(e_hrsold),e_minsold=60*(e_hrsold-hrsold),minsold=Math.floor(60*(e_hrsold-hrsold)),seconds=Math.floor(60*(e_minsold-minsold)),since.innerHTML=daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}show_date_time()</script><div class="float-action-buttons"><com-tips dir="left" tips="回到顶部" style="display:block" class="backtop"><button type="button" class="btn shadow" id="back-top"><i class="iconfont cg-backtop"></i></button></com-tips><com-tips dir="left" tips="昼夜切换" style="display:block"><button type="button" class="btn shadow" id="lightBtn"><i class="iconfont cg-rijian"></i> <i class="iconfont cg-zhanghu-heiye"></i></button></com-tips><com-popover><com-tips dir="left" tips="设置"><button type="button" class="btn shadow" id="setbtn"><i class="iconfont cg-shezhi"></i></button></com-tips><com-popcon u-none><div id="settingsPopup" class="shadow"><div class="settings-item"><div class="settings-item-lable">夜间模式</div><com-switch id="lightSwitch"></com-switch></div><div class="settings-item"><div class="settings-item-lable">字体</div><com-radio-group id="fontFamily" defaultvalue="sans-serif"><com-radio value="sans-serif">sans-serif</com-radio><com-radio value="serif">serif</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">阴影</div><com-radio-group id="boxShadowBlur" defaultvalue="5"><com-radio value="0">无</com-radio><com-radio value="5">浅</com-radio><com-radio value="15">深</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">滤镜</div><com-radio-group id="filterColor" defaultvalue="none"><com-radio value="none">关闭</com-radio><com-radio value="sunset">日落</com-radio><com-radio value="sunrise">日出</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">圆角</div><com-slider id="radiusSlider" showtips suffix="px" min="0" max="20"></com-slider></div></div></com-popcon></com-popover><com-tips dir="left" tips="菜单" class="aside-menu"><button type="button" class="btn shadow" id="asideMenu"><i class="iconfont cg-menu"></i></button></com-tips></div><script type="text/javascript">(window.ActiveXObject||"ActiveXObject"in window)&&(document.body.innerHTML="<h2 style='text-align:center; line-height:100px; font-weight:700;'>为了更好的体验,请使用非IE浏览器</h2><footer class='layout-footer'><div>© 2019 - <span itemprop='copyrightYear'>2020</span> 白云苍狗.</div><div>由<a> Hexo </a>强力驱动; Theme by <a href='//github.com/MaLuns/MalBlog/tree/master/themes/hexo-theme-simple' target='_blank'>hexo-theme-simple </a>;</div><div>博客已萌萌哒运行: <span id='since'>379天22小时55分55秒</span> <span class='my-face'>(●'◡'●)ﾉ♥</span></div></footer>");var CONFIG={favicon:{visibilitychange:JSON.parse("true"),narmal:"/images/favicon.png",hidden:"/images/failure.png",show_text:"(/≧▽≦/)咦！又好了！",hide_text:"(●—●)喔哟，崩溃啦！"}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/MoePlayer/APlayer@1.10.1/dist/APlayer.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script><script type="text/javascript" src="//at.alicdn.com/t/font_1518765_5jbj7btfht2.js"></script><script type="text/javascript" src="//imgcache.qq.com/qcloud/tcbjs/1.6.0/tcb.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script src="/js/index.min.js?v=0.2.10.js"></script><script>"serviceWorker"in navigator?navigator.serviceWorker.register("/sw.js").then(function(){navigator.serviceWorker.controller?console.log("Assets cached by the controlling service worker."):console.log("Please reload this page to allow the service worker to handle network operations.")}).catch(function(e){console.log("ERROR: "+e)}):console.log("Service workers are not supported in the current browser.")</script></body></html>