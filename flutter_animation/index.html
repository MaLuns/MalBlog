<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="x5-fullscreen" content="true"><meta name="full-screen" content="yes"><meta name="theme-color" content="#317EFB"><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=0" name="viewport"><meta name="keywords" content="flutter,animation,C#,.Net,JavaScript,HTML,CSS"><meta name="description" content="Flutter 中动画的创建有很多种, 需要根据具体的需求选择不同的动画。如果只是简单的布局等的动画直接使用最简单的隐式动画就可以了，因为隐式动画是由框架控制的，所以仅仅只需要更改变需要变化属性就可以了。如果你想自己控制动画的变换则需要使用显示动画，如果需要控制一些列动画组合时使用交织动画去控制。如果内置的满足不了需求的时候，还可以结合画布自绘动画。"><meta property="og:type" content="article"><meta property="og:title" content="Flutter 中的动画"><meta property="og:url" content="https://www.imalun.com/flutter_animation/index.html"><meta property="og:site_name" content="白云苍狗"><meta property="og:description" content="Flutter 中动画的创建有很多种, 需要根据具体的需求选择不同的动画。如果只是简单的布局等的动画直接使用最简单的隐式动画就可以了，因为隐式动画是由框架控制的，所以仅仅只需要更改变需要变化属性就可以了。如果你想自己控制动画的变换则需要使用显示动画，如果需要控制一些列动画组合时使用交织动画去控制。如果内置的满足不了需求的时候，还可以结合画布自绘动画。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.imalun.com/images/posts/flutter_animation/gxt.png"><meta property="og:image" content="https://www.imalun.com/images/posts/flutter_animation/lct.png"><meta property="article:published_time" content="2021-04-28T15:04:50.000Z"><meta property="article:modified_time" content="2021-07-16T05:23:20.737Z"><meta property="article:author" content="白云苍狗"><meta property="article:tag" content="flutter"><meta property="article:tag" content="animation"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.imalun.com/images/posts/flutter_animation/gxt.png"><meta name="description" content="学习.Net,前端时长三年的,程序猿"><title>白云苍狗 - Flutter 中的动画</title><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=0.2.10"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="canonical" href="https://www.imalun.com/flutter_animation/"><link rel="stylesheet" href="//at.alicdn.com/t/font_1518765_5jbj7btfht2.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/MoePlayer/APlayer@1.10.1/dist/APlayer.min.css"><link rel="stylesheet" href="/css/index.css?v=0.2.10.css"><script type="text/javascript">~function () {
            let setting = localStorage.getItem('setting') ? JSON.parse(localStorage.getItem('setting')) : {};
            let root = document.documentElement;
            for (let key in setting) {
                if (key === 'lightSwitch') {
                    root.classList[setting[key] ? 'add' : 'remove']('dark')
                } else if(key === 'themeColorPicker'){

                } else {
                    setting[key].css.forEach(item => { root.style.setProperty(item.key, item.val); })
                }
            }
        }();</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="白云苍狗" type="application/atom+xml"></head><body><div class="page-img-bg"></div><header class="layout-header"><button type="button" class="header-menu-btn"><i class="iconfont cg-toggle"></i></button><nav class="nav"><li><a data-pjax class="_pjax" href="/">白云苍狗</a></li><li><a data-pjax class="_pjax" href="/archives"><i class="iconfont cg-shijian"></i> 归档</a></li><li><a data-pjax class="_pjax" href="/links"><i class="iconfont cg-links"></i> 友情链接</a></li></nav></header><div class="layout-content"><header class="layout-content-header"><div class="shape"><span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></div><div class="banner" data-text="白云苍狗" data-interval="100"><div class="title-inner">白云苍狗</div><div class="user-des"><span style="width:55em;animation:typing 10s steps(55),caret .5s steps(1) infinite">「一觉游仙好梦，任它竹冷松寒。轩辕事，古今谈，风流河山。沉醉负白首，舒怀成大观。醒，亦在人间；梦，亦在人间」</span></div></div></header><div class="layout-content-content"><aside id="layout-content-aside" class="layout-content-aside"><div class="aside-nav-card shadow"><header><h2>白云苍狗</h2><p>亦在人间</p></header><ul><a href="/" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-home"></use></svg> 首页</li></a><a href="/links" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-links"></use></svg> 友情链接</li></a><a href="/comment" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-comment"></use></svg> 留言</li></a><a href="/atom.xml" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-rss"></use></svg> RSS</li></a><a href="//github.com/MaLuns" target="_blank" rel="noopener" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-github"></use></svg> Github</li></a><a href="//gitee.com/ml13" target="_blank" rel="noopener" class="_pjax"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-gitee"></use></svg> Gitee</li></a><a href="tencent://message/?uin=384399021&amp;Site=有事Q我&amp;Menu=yes"><li><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-qq"></use></svg> 联系我</li></a></ul></div><div class="user-card shadow"><img src="/images/avatar.jpg" alt="" class="avatar"><div><p style="margin:20px">醒，亦在人间；梦，亦在人间</p><div class="post-state"><div><span class="item-count">24 </span><span>文章</span></div><div><span class="item-count">3 </span><span>分类</span></div><div><span class="item-count">21 </span><span>标签</span></div></div></div><div id="post-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#动画基础"><span class="toc-number">1.</span> <span class="toc-text">动画基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#动画组成结构"><span class="toc-number">1.1.</span> <span class="toc-text">动画组成结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动画选择"><span class="toc-number">1.2.</span> <span class="toc-text">动画选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#隐式动画"><span class="toc-number">2.</span> <span class="toc-text">隐式动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#内置隐式动画"><span class="toc-number">2.1.</span> <span class="toc-text">内置隐式动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义隐式动画"><span class="toc-number">2.2.</span> <span class="toc-text">自定义隐式动画</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显示动画"><span class="toc-number">3.</span> <span class="toc-text">显示动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#内置显示动画"><span class="toc-number">3.1.</span> <span class="toc-text">内置显示动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制器补间和曲线"><span class="toc-number">3.2.</span> <span class="toc-text">控制器补间和曲线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义显示动画"><span class="toc-number">3.3.</span> <span class="toc-text">自定义显示动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#交织动画"><span class="toc-number">3.4.</span> <span class="toc-text">交织动画</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hero动画"><span class="toc-number">4.</span> <span class="toc-text">Hero动画</span></a></li></ol></div></div></aside><div id="sidebar-mask"></div><main id="main" class="layout-content-main"><article class="shadow animated fadeInUp"><header class="post-header"><div class="post-container"><h2 class="post-title">「Flutter 中的动画」</h2><div class="post-meta"><div><span class="post-push-time"><time datetime="2021-04-28T15:04:50.000Z" title="2021-04-28T15:04:50.000Z" itemprop="datePublished"><i class="iconfont cg-shijian"></i> 2021-04-28 </time><span class="post-meta-divider">•</span> </span><span><i class="iconfont cg-tag1"></i> 记录类 <span class="post-meta-divider">•</span> </span><span><i class="iconfont cg-tag1"></i> <a class="_pjax" href="/categories/记录类">记录类</a></span></div><span class="post-wordcount"><span class="post-meta-item-text"><i class="iconfont cg-wendang"></i> 共2.8k字 </span><span class="post-meta-divider">•</span> </span><span class="post-consuming-time"><span class="post-meta-item-text"><i class="iconfont cg-shalou"></i> 约11分钟</span></span></div></div></header><div id="nice" class="post-content post-content-detail"><p>Flutter 中动画的创建有很多种, 需要根据具体的需求选择不同的动画。如果只是简单的布局等的动画直接使用最简单的隐式动画就可以了，因为隐式动画是由框架控制的，所以仅仅只需要更改变需要变化属性就可以了。如果你想自己控制动画的变换则需要使用显示动画，如果需要控制一些列动画组合时使用交织动画去控制。如果内置的满足不了需求的时候，还可以结合画布自绘动画。</p><a id="more"></a><h2 id="动画基础"><a href="#动画基础" class="headerlink" title="动画基础"></a>动画基础</h2><p>Flutter动画和其他平台动画原理也是一样的，都是在快速更改UI实现动画效果。在一个Flutter动画中主要包含Animation（动画）、AnimationController（控制器）、Curve（速度曲线）、Animatable（动画取值范围）、Listeners （监听事件）、Ticker（帧）。</p><ul><li>Animation 一个抽象类是Flutter动画的核心类，主用于保存动画当前插值的和状态，在动画运行时会持续生成介于两个值之间的插入值。例如当宽从100变成200，会在动画第一帧到最后一帧都会生成100-200区间的一个值，如果速度是匀速的，这个值就是匀速增加到200。</li><li>AnimationController 用来控制动画的状态启动、暂停、反向运行等, 是Animation的一个子类</li><li>Curve 用来定义动画运动的是匀速运动还是匀加速等，和 css 中 animation-timing-function 类似</li><li>Animatable 用于表明动画值范围值。可以通过调用animate方法，返回一个Animation，常见的Tween系列的类都是对他的实现</li><li>Listener 监听动画状态的变化</li><li>Ticker 帧回调，在动画执行时候每一帧都会调用其回调，类似与 js 中的 requestAnimationFrame</li></ul><h3 id="动画组成结构"><a href="#动画组成结构" class="headerlink" title="动画组成结构"></a>动画组成结构</h3><p><img src="/images/posts/flutter_animation/gxt.png" alt="结构图"></p><h3 id="动画选择"><a href="#动画选择" class="headerlink" title="动画选择"></a>动画选择</h3><p><img src="/images/posts/flutter_animation/lct.png" alt="流程图"></p><h2 id="隐式动画"><a href="#隐式动画" class="headerlink" title="隐式动画"></a>隐式动画</h2><p>隐式动画简单来说就是我们只需要修改对应的属性，Flutter就是自己帮我们过渡动画，和css中过渡有点类似，当我们设置后transition后只需要更改对应的css属性就会自动过渡到新的值。Flutter 内置了一些常用的隐式动画，可以看到源码里都是对ImplicitlyAnimatedWidget的实现，如果需要我们也可以自己实现ImplicitlyAnimatedWidget来自定义隐式动画。</p><h3 id="内置隐式动画"><a href="#内置隐式动画" class="headerlink" title="内置隐式动画"></a>内置隐式动画</h3><p>看个使用例子</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 首先我们在一个StatefulWidget定义 一个height和color</span></span><br><span class="line"><span class="built_in">double</span> heihgt = <span class="number">100</span>;</span><br><span class="line">Color color = Colors.yellow[<span class="number">800</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在build 怎加一个隐式动画组建 AnimatedContainer，需要个Duration（动画执行时间），其他的参数和Container的基本一致</span></span><br><span class="line">AnimatedContainer(</span><br><span class="line">    duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">500</span>), </span><br><span class="line">    height: heihgt, <span class="comment">// 使用我们定义好的值</span></span><br><span class="line">    color: color,</span><br><span class="line">    margin: EdgeInsets.all(<span class="number">8</span>),</span><br><span class="line">    child: Center(</span><br><span class="line">        child: Text(<span class="string">'AnimatedContainer'</span>,</span><br><span class="line">            style: TextStyle(color: Colors.white, fontSize: <span class="number">20</span>),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在需要执行动画时候我们修改 height 和 color 值,就会看到 上边的组建会一边变高边过渡到蓝色上</span></span><br><span class="line">setState(() &#123;</span><br><span class="line">    heihgt = <span class="number">200</span>;</span><br><span class="line">    color = Colors.blue;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在Flutter内置的隐式动画组件中，一般都是AnimatedXxxxxx类似的，后面的Xxxxxx都能找到对应的组件。内置的有下面这些 AnimatedContainer、AnimatedPadding、AnimatedAlign、AnimatedPositioned、AnimatedOpacity、SliverAnimatedOpacity、AnimatedDefaultTextStyle、AnimatedPhysicalModel。这些隐式动画的使用和其Xxxxxx对应的属性基本一致，只需要额外的指定 duration 就可以了，当然也可以为动画指定动画曲线 curve。</p><h3 id="自定义隐式动画"><a href="#自定义隐式动画" class="headerlink" title="自定义隐式动画"></a>自定义隐式动画</h3><p>当这内置的满足不了你的时候，你也可以去实现一个隐式动画，只需要实现抽象类 ImplicitlyAnimatedWidget。实现自定义隐式动画仅需要重写build 和 forEachTween 就可以简单实现了。</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 直接继承ImplicitlyAnimatedWidget </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimatedDemo</span> <span class="keyword">extends</span> <span class="title">ImplicitlyAnimatedWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Color color;</span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> height;</span><br><span class="line"></span><br><span class="line">  AnimatedDemo(&#123;</span><br><span class="line">    <span class="keyword">this</span>.color,</span><br><span class="line">    <span class="keyword">this</span>.height,</span><br><span class="line">    Curve curve = Curves.linear,</span><br><span class="line">    <span class="keyword">this</span>.child,</span><br><span class="line">    <span class="meta">@required</span> <span class="built_in">Duration</span> duration,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(curve: curve, duration: duration);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _AnimatedDemo createState() =&gt; _AnimatedDemo();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为ImplicitlyAnimatedWidget是继承 StatefulWidget 的，所以还需要继承他的状态类 （AnimatedWidgetBaseState 继承自 ImplicitlyAnimatedWidgetState）</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_AnimatedDemo</span> <span class="keyword">extends</span> <span class="title">AnimatedWidgetBaseState</span>&lt;<span class="title">AnimatedDemo</span>&gt; </span>&#123;</span><br><span class="line">  ColorTween _color;</span><br><span class="line">  Tween&lt;<span class="built_in">double</span>&gt; _height;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 在动画执行时候会每一帧都调用 build</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      color: _color.evaluate(animation), <span class="comment">//使用evaluate可以获取Tween当前帧的状态值</span></span><br><span class="line">      height: _height.evaluate(animation),</span><br><span class="line">      child: widget.child,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//首次build和更新时候会调用，在这里设置动画需要的Tween的开始值和结束值</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> forEachTween(visitor) &#123;</span><br><span class="line">    <span class="comment">//visitor 有三个参数（当前的tween，动画终止状态，一个回调函数（将第一次给定的值设置为Tween的开始值））</span></span><br><span class="line">    _color = visitor(_color, widget.color, (value) =&gt; ColorTween(begin: value));<span class="comment">// 这里value==首次widget.color的值</span></span><br><span class="line">    _height = visitor(_height, widget.height, (value) =&gt; Tween&lt;<span class="built_in">double</span>&gt;(begin: value));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们可以去看 ImplicitlyAnimatedWidget 是如何控制动画的，在 ImplicitlyAnimatedWidgetState 中会看到其实里面定义了 AnimationController 控制动画。然后可以看到 didUpdateWidget 钩子函数中调用了 _controller.forward() 执行动画，当父 Widget 调用 setState 时候就会触发这个钩子函数的调用。</p><h2 id="显示动画"><a href="#显示动画" class="headerlink" title="显示动画"></a>显示动画</h2><p>有时候有些动画需要们自己去控制动画的状态，而不是交给框架去处理，这时就需要我们自己去定义前面简介里提到的那几个动画要素了。</p><h3 id="内置显示动画"><a href="#内置显示动画" class="headerlink" title="内置显示动画"></a>内置显示动画</h3><p>在Flutter中内置的显示动画大部分都是XxxxxxTransition名称的，我们看个内置显示动画使用例子，RotationTransition组件需要一个 turns（Animation&lt;double&gt;）参数,我们可以给它个AnimationController</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RotationTransition 参数</span></span><br><span class="line">RotationTransition(</span><br><span class="line">   turns: Animation&lt;<span class="built_in">double</span>&gt;,</span><br><span class="line">   child: ChildWidget(),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// AnimationController 参数</span></span><br><span class="line">AnimationController(</span><br><span class="line">  <span class="built_in">double</span>? value, <span class="comment">// 初始值</span></span><br><span class="line">  <span class="keyword">this</span>.duration, <span class="comment">//动画时间</span></span><br><span class="line">  <span class="keyword">this</span>.reverseDuration, <span class="comment">// 反向动画执行的时间</span></span><br><span class="line">  <span class="keyword">this</span>.debugLabel, </span><br><span class="line">  <span class="keyword">this</span>.lowerBound = <span class="number">0.0</span>, <span class="comment">//动画开始值</span></span><br><span class="line">  <span class="keyword">this</span>.upperBound = <span class="number">1.0</span>, <span class="comment">//动画结束值</span></span><br><span class="line">  <span class="keyword">this</span>.animationBehavior = AnimationBehavior.normal,</span><br><span class="line">  required TickerProvider vsync, <span class="comment">//垂直同步，需要一个 Ticker ,Flutter 给我们提供了</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>使用 RotationTransition，可以看到一个红蓝渐变色方块旋转一周。</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RotationTransitionDemo</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _RotationTransitionDemoState createState() =&gt; _RotationTransitionDemoState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_RotationTransitionDemoState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">RotationTransitionDemo</span>&gt; <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController _controller;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">// 设置动画时间为1秒</span></span><br><span class="line">    _controller = AnimationController(duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>), vsync: <span class="keyword">this</span>)</span><br><span class="line">    ..addListener(() &#123; <span class="comment">// 监听动画的状态值发生变化</span></span><br><span class="line">        <span class="built_in">print</span>(_controller.value);</span><br><span class="line">    &#125;)</span><br><span class="line">    ..addStatusListener((status) &#123; <span class="comment">//监听动画状态</span></span><br><span class="line">        <span class="comment">// dismissed 动画在起始点停止</span></span><br><span class="line">        <span class="comment">// forward 动画正在正向执行</span></span><br><span class="line">        <span class="comment">// reverse 动画正在反向执行</span></span><br><span class="line">        <span class="comment">// completed 动画在终点停止</span></span><br><span class="line">        <span class="built_in">print</span>(status);</span><br><span class="line">    &#125;)</span><br><span class="line">    ..forward(); <span class="comment">// 执行动画</span></span><br><span class="line">    <span class="comment">// 常用方法</span></span><br><span class="line">    <span class="comment">// forward() // 正向执行动画</span></span><br><span class="line">    <span class="comment">// reverse() 反向执行动画</span></span><br><span class="line">    <span class="comment">// repeat() 重复执行 可以传个参数 是否会反向运动</span></span><br><span class="line">    <span class="comment">// stop() 停止动画</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">'RotationTransition'</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: RotationTransition(</span><br><span class="line">          turns: _controller, <span class="comment">// 设置 Animation</span></span><br><span class="line">          child: Container(</span><br><span class="line">            height: <span class="number">300</span>,</span><br><span class="line">            width: <span class="number">300</span>,</span><br><span class="line">            decoration: BoxDecoration(</span><br><span class="line">              gradient: LinearGradient(colors: [Colors.red, Colors.blue]),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="控制器补间和曲线"><a href="#控制器补间和曲线" class="headerlink" title="控制器补间和曲线"></a>控制器补间和曲线</h3><p>在控制器中我们可以看的动画开始值和结束值默认是0.0到1.0，而且是double类型的。而实际动画中不可能只是double类型的，需要我们自己使用Animatable来指定补间范围值。<br>修改一下上面的代码</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过控制器的drive方法添加</span></span><br><span class="line"> _controller = AnimationController(duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>),vsync: <span class="keyword">this</span>)</span><br><span class="line">  ..drive(Tween(begin: <span class="number">1</span>, end: <span class="number">4</span>)) <span class="comment">//使用Tween（Animatable的子类）指定补间范围</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 我也也可以是使用Animatable的animate方法添加到控制器</span></span><br><span class="line">Tween(begin: <span class="number">1</span>, end: <span class="number">4</span>).animate(_controller);</span><br><span class="line"><span class="comment">// 这样写我们可以使用 chain() 叠加多个 Tween</span></span><br><span class="line">Tween(begin: <span class="number">1</span>, end: <span class="number">4</span>)</span><br><span class="line">.chain(CurveTween(curve: Curves.ease)) <span class="comment">//叠加个曲线</span></span><br><span class="line">.animate(_controller);</span><br></pre></td></tr></table></figure><p>Flutter已经内置帮我们实现了很多Animatable，ColorTween、SizeTween、IntTween、StepTween等等。</p><h3 id="自定义显示动画"><a href="#自定义显示动画" class="headerlink" title="自定义显示动画"></a>自定义显示动画</h3><p>查看 RotationTransition 的源码，我们可以看到它是对的抽象类 AnimatedWidget 的实现，当内置的满足不了我们的时候，可以直接自己实现 AnimatedWidget 自定义显示动画。先来看看 AnimatedWidget 里面都有些啥。</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只摘取主要的部分</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AnimatedWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> AnimatedWidget(&#123; Key key,<span class="meta">@required</span> <span class="keyword">this</span>.listenable,  &#125;) : <span class="keyword">assert</span>(listenable != <span class="keyword">null</span>), <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _AnimatedState createState() =&gt; _AnimatedState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_AnimatedState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">AnimatedWidget</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    widget.listenable.addListener(_handleChange);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> _handleChange() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      <span class="comment">// 我们可以看到显示动画是通过控制器监听插值更改 setState 进行重绘。</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来我自己继承 AnimatedWidget 实现一个自定义显示动画</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 继承 AnimatedWidget</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OpacityAnimatedWidget</span> <span class="keyword">extends</span> <span class="title">AnimatedWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget child;</span><br><span class="line">  Animation&lt;Color&gt; colorAnimation;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// AnimatedWidget 需要可传递一个 listenable 进去，我们可以传递个 AnimationController</span></span><br><span class="line">  OpacityAnimatedWidget(listenable, &#123;<span class="keyword">this</span>.colorAnimation, <span class="keyword">this</span>.child&#125;) : <span class="keyword">super</span>(listenable: listenable);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    Animation&lt;<span class="built_in">double</span>&gt; animation = listenable;</span><br><span class="line">    <span class="keyword">return</span> Opacity(</span><br><span class="line">      opacity: animation.value,</span><br><span class="line">      child: Container(</span><br><span class="line">        color: colorAnimation.value,</span><br><span class="line">        child: child,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 需要在状态类上 混入一个 SingleTickerProviderStateMixin</span></span><br><span class="line">AnimationController _controller = AnimationController(duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">1000</span>), vsync: <span class="keyword">this</span>); </span><br><span class="line"></span><br><span class="line">OpacityAnimatedWidget(</span><br><span class="line">  Tween(begin: <span class="number">1.0</span>, end: <span class="number">.8</span>).animate(_controller),</span><br><span class="line">  colorAnimation: ColorTween(begin: Colors.red, end: Colors.blue).animate(_controller),</span><br><span class="line">  child: Container(</span><br><span class="line">    height: <span class="number">300</span>,</span><br><span class="line">    width: <span class="number">300</span>,</span><br><span class="line">  ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Flutter 内部还提供了一个 AnimatedBuilder 帮助我们简化自定义动画。</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 只需要三个三参数</span></span><br><span class="line">AnimatedBuilder( </span><br><span class="line">  animation, <span class="comment">// 一个listenable</span></span><br><span class="line">  child,<span class="comment">// 传入个子组件，非必填</span></span><br><span class="line">  builder,<span class="comment">// (BuildContext context, Widget child)&#123;&#125;  这里的第二个参数 child ，就是上面传入的 child</span></span><br><span class="line">  <span class="comment">// 这么做的好处就是，动画执行的时候只会执行 builder ,如果一个动画只是包裹层需要执行动画，这个时候就可以把包裹的子组件 放到外面传进去</span></span><br><span class="line">  <span class="comment">// 这样就每次只需要 执行 builder 而方法第二个参数是传递进来的引用，所以可以避免每次都更新，减少开销</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="交织动画"><a href="#交织动画" class="headerlink" title="交织动画"></a>交织动画</h3><p>官方是这么介绍的：交织动画是一个简单的概念：视觉变化是随着一系列的动作发生，而不是一次性的动作。动画可能是纯粹顺序的，一个改变随着一个改变发生，动画也可能是部分或者全部重叠的。动画也可能有间隙，没有变化发生。</p><p>简单点说就是一个动画可以分割成很多片段，每个片段都有不同的Tween,看个使用示例</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaggeredAnimationDemo</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _StaggeredAnimationDemoState createState() =&gt; _StaggeredAnimationDemoState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_StaggeredAnimationDemoState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">StaggeredAnimationDemo</span>&gt; <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController _controller;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; _height;</span><br><span class="line">  Animation&lt;Color&gt; _color;</span><br><span class="line">  Animation&lt;<span class="built_in">double</span>&gt; _borderRadius;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _controller = AnimationController(duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">5000</span>), vsync: <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    _height = Tween(begin: <span class="number">50.0</span>, end: <span class="number">300.0</span>).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(<span class="number">0</span>, <span class="number">0.15</span>), <span class="comment">// Interval 范围必须是0-1 指定Tween在哪一段时间执行</span></span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _color = ColorTween(begin: Colors.red, end: Colors.blue).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(<span class="number">0.1</span>, <span class="number">0.2</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _borderRadius = Tween(begin: <span class="number">10.0</span>, end: <span class="number">150.0</span>).animate(</span><br><span class="line">      CurvedAnimation(</span><br><span class="line">        parent: _controller,</span><br><span class="line">        curve: Interval(<span class="number">0.1</span>, <span class="number">0.25</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    _controller.forward();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _controller.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> BasiceAppLayout(</span><br><span class="line">      title: <span class="string">'交织动画'</span>,</span><br><span class="line">      body: Center(</span><br><span class="line">        child: AnimatedBuilder(</span><br><span class="line">          animation: _controller,</span><br><span class="line">          builder: (context, child) &#123;</span><br><span class="line">            <span class="keyword">return</span> Container(</span><br><span class="line">              height: _height.value,</span><br><span class="line">              width: _height.value,</span><br><span class="line">              decoration: BoxDecoration(</span><br><span class="line">                color: _color.value,</span><br><span class="line">                borderRadius: BorderRadius.circular(_borderRadius.value),</span><br><span class="line">              ),</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Hero动画"><a href="#Hero动画" class="headerlink" title="Hero动画"></a>Hero动画</h2><p>Flutter叫它主动画，用于不同页面之间切换时候动画，比如有一个商品列表，点击后跳到一个新的页面查看原图，就可以这个动画。使用也很简单，在不同页面使用Hero包裹需要动画组件，两个页面的 tag 需要甚至成一直，但是同一个页面需要保持唯一。</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">Hero(</span><br><span class="line">  tag: <span class="string">"avatar"</span>, <span class="comment">//唯一标记，前后两个路由页Hero的tag必须相同</span></span><br><span class="line">  child: ChildWidget(),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><div class="post-content-tag"><svg class="cg-icon" aria-hidden="true"><use xlink:href="#cg-tag"></use></svg> <a class="_pjax" href="/tags/Flutter"><span>Flutter</span></a></div></div></article><div id="share_container"><div></div><div></div><div></div><div></div></div><div class="prev-next-content"><div class="btn-prev"><div><i class="iconfont cg-shangyige"></i> 上一篇</div><a class="_pjax" href="/vscode_extension/">vscode 插件开发指北 (一)</a></div><div class="btn-next"><div>下一篇 <i class="iconfont cg-xiayige"></i></div><a class="_pjax" href="/mongodb_sql/">MongoDB基础篇（一）</a></div></div></main></div></div><footer class="layout-footer"><div>© 2019 - <span itemprop="copyrightYear">2021</span> 白云苍狗.</div><div>由<a> Hexo </a>强力驱动; Theme by <a href="//github.com/MaLuns/MalBlog/tree/master/themes/hexo-theme-simple" target="_blank">hexo-theme-simple </a>;</div><div>博客已萌萌哒运行: <span id="since"></span> <span class="my-face">(●'◡'●)ﾉ♥</span></div></footer><div id="aplayer-fixed"></div><script type="text/javascript">function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("11/19/2019 17:00:00"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=Math.floor(e_hrsold),e_minsold=60*(e_hrsold-hrsold),minsold=Math.floor(60*(e_hrsold-hrsold)),seconds=Math.floor(60*(e_minsold-minsold)),since.innerHTML=daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}show_date_time()</script><div class="float-action-buttons"><com-tips dir="left" tips="回到顶部" style="display:block" class="backtop"><button type="button" class="btn shadow" id="back-top"><i class="iconfont cg-backtop"></i></button></com-tips><com-tips dir="left" tips="昼夜切换" style="display:block"><button type="button" class="btn shadow" id="lightBtn"><i class="iconfont cg-rijian"></i> <i class="iconfont cg-zhanghu-heiye"></i></button></com-tips><com-popover><com-tips dir="left" tips="设置"><button type="button" class="btn shadow" id="setbtn"><i class="iconfont cg-shezhi"></i></button></com-tips><com-popcon u-none><div id="settingsPopup" class="shadow"><div class="settings-item"><div class="settings-item-lable">夜间模式</div><com-switch id="lightSwitch"></com-switch></div><div class="settings-item"><div class="settings-item-lable">字体</div><com-radio-group id="fontFamily" defaultvalue="sans-serif"><com-radio value="sans-serif">sans-serif</com-radio><com-radio value="serif">serif</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">阴影</div><com-radio-group id="boxShadowBlur" defaultvalue="5"><com-radio value="0">无</com-radio><com-radio value="5">浅</com-radio><com-radio value="15">深</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">滤镜</div><com-radio-group id="filterColor" defaultvalue="none"><com-radio value="none">关闭</com-radio><com-radio value="sunset">日落</com-radio><com-radio value="sunrise">日出</com-radio></com-radio-group></div><div class="settings-item"><div class="settings-item-lable">圆角</div><com-slider id="radiusSlider" showtips suffix="px" min="0" max="20"></com-slider></div></div></com-popcon></com-popover><com-tips dir="left" tips="菜单" class="aside-menu"><button type="button" class="btn shadow" id="asideMenu"><i class="iconfont cg-menu"></i></button></com-tips></div><script type="text/javascript">(window.ActiveXObject||"ActiveXObject"in window)&&(document.body.innerHTML="<h2 style='text-align:center; line-height:100px; font-weight:700;'>为了更好的体验,请使用非IE浏览器</h2><footer class='layout-footer'><div>© 2019 - <span itemprop='copyrightYear'>2020</span> 白云苍狗.</div><div>由<a> Hexo </a>强力驱动; Theme by <a href='//github.com/MaLuns/MalBlog/tree/master/themes/hexo-theme-simple' target='_blank'>hexo-theme-simple </a>;</div><div>博客已萌萌哒运行: <span id='since'>379天22小时55分55秒</span> <span class='my-face'>(●'◡'●)ﾉ♥</span></div></footer>");var CONFIG={favicon:{visibilitychange:JSON.parse("true"),narmal:"/images/favicon.png",hidden:"/images/failure.png",show_text:"(/≧▽≦/)咦！又好了！",hide_text:"(●—●)喔哟，崩溃啦！"}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/MoePlayer/APlayer@1.10.1/dist/APlayer.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script><script type="text/javascript" src="//at.alicdn.com/t/font_1518765_5jbj7btfht2.js"></script><script type="text/javascript" src="//imgcache.qq.com/qcloud/tcbjs/1.6.0/tcb.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script src="/js/index.min.js?v=0.2.10.js"></script><script>"serviceWorker"in navigator?navigator.serviceWorker.register("/sw.js").then(function(){navigator.serviceWorker.controller?console.log("Assets cached by the controlling service worker."):console.log("Please reload this page to allow the service worker to handle network operations.")}).catch(function(e){console.log("ERROR: "+e)}):console.log("Service workers are not supported in the current browser.")</script></body></html>